<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TG Reason Roulette</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #1c1c1d);
            --text-color: var(--tg-theme-text-color, #ffffff);
            --hint-color: var(--tg-theme-hint-color, #8e8e93);
            --link-color: var(--tg-theme-link-color, #248bfe);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #242424);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .chat-container {
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .bot-header { margin-bottom: 30px; }
        .bot-header .icon { font-size: 60px; margin-bottom: 10px; }
        
        /* –†—É–ª–µ—Ç–∫–∞ */
        .viewport {
            position: relative;
            width: 100%;
            height: 100px;
            background: var(--secondary-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
        }

        .line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--link-color);
            z-index: 10;
            transform: translateX(-50%);
            box-shadow: 0 0 10px var(--link-color);
        }

        .tape {
            display: flex;
            position: absolute;
            left: 0;
            height: 100%;
            align-items: center;
            transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1);
        }

        .reason-card {
            min-width: 220px;
            text-align: center;
            font-weight: 700;
            font-size: 16px;
            padding: 0 20px;
            white-space: normal;
            line-height: 1.2;
        }

        /* –¶–≤–µ—Ç–∞ —Ä–µ–¥–∫–æ—Å—Ç–µ–π */
        .r-common { color: var(--hint-color); }
        .r-rare { color: #bf5af2; }
        .r-legendary { color: #ff453a; }
        .r-ancient { 
            color: #ffd60a; 
            text-shadow: 0 0 10px rgba(255,214,10,0.5);
            font-size: 18px;
        }

        #status {
            margin-top: 20px;
            font-size: 15px;
            color: var(--hint-color);
            padding: 0 20px;
            height: 40px;
        }
    </style>
</head>
<body>

    <div class="chat-container">
        <div class="bot-header">
            <div class="icon">ü§ò</div>
            <h2 style="margin: 0;">–ü—Ä–∏—á–∏–Ω–æ–ª—è—Ç–æ—Ä</h2>
            <p id="sub-header" style="color: var(--hint-color); font-size: 14px;">–°—É–¥—å–±–∞ –¥—Ä–æ—á–∫–∏-–æ–¥–∏–Ω–æ—á–∫–∏ —Ä–µ—à–∞–µ—Ç...</p>
        </div>

        <div class="viewport">
            <div class="line"></div>
            <div class="tape" id="tape"></div>
        </div>

        <div id="status">–ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–Ω–∏–∑—É</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ –¢–ì
        tg.MainButton.setText("–ò–°–ü–´–¢–ê–¢–¨ –£–î–ê–ß–£");
        tg.MainButton.show();
        tg.MainButton.onClick(() => spin());

        const reasons = [
            { t: "–ê —Ö—É–ª–∏ –Ω–µ—Ç, –∫–æ–≥–¥–∞ –¥–∞?", r: "common" },
            { t: "–¢–≤–æ—è –ø—Ä–∞–≤–∞—è ‚Äî —Ç–≤–æ—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è", r: "common" },
{ t: "–î–µ—à–µ–≤–ª–µ, —á–µ–º —Å–≤–∏–¥–∞–Ω–∏–µ", r: "common" },
            { t: "–¢—Ä–µ–Ω–∞–∂–µ—Ä–∫–∞ –¥–ª—è –±–µ–¥–Ω—ã—Ö", r: "common" },
            { t: "–ü–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã ‚Äî –î—Ä–æ—á–∫–∞-–æ–¥–∏–Ω–æ—á–∫–∞", r: "rare" },
            { t: "–ê–∫—Ü–∏—è: 15 –º–∏–Ω—É—Ç –ø–æ–∑–æ—Ä–∞ –∏ —Å–ø–∞—Ç—å", r: "rare" },
            { t: "–£—Ç–µ—à–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏–∑ –∑–∞ –∂–∏–∑–Ω—å", r: "rare" },
            { t: "–ì–µ–Ω–æ—Ü–∏–¥ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –≥–µ–Ω–∏–µ–≤", r: "legendary" },
            { t: "–ò–ù–¢–ï–†–ù–ï–¢-–ì–ï–†–û–ô, –ú–ê–ú–ò–ù –ö–û–í–ë–û–ô", r: "legendary" },
            { t: "‚òÖ –°–¢–ê–¢–£–°: –õ–ï–ì–ï–ù–î–ê–†–ù–´–ô –û–î–ò–ù–û–ß–ö–ê", r: "ancient" },
            { t: "‚òÖ –ú–ê–°–¢–ï–†-–ö–õ–ê–°–° –ü–û –°–ê–ú–û–û–ë–ú–ê–ù–£", r: "ancient" },
            { t: "–ê –ö–¢–û –¢–ï–ë–ï –ó–ê–ü–†–ï–¢–ò–¢?", r: "common" },
            { t: "–ù–£, –¢–´ –ñ–ï –ó–ù–ê–ï–®–¨: –†–£–ö–ò-–ë–û–ó–£–ö–ò", r: "rare" }
        ];

        const tape = document.getElementById('tape');
        const status = document.getElementById('status');
        const cardWidth = 220;

        function spin() {
            // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            tg.HapticFeedback.notificationOccurred('success');
            tg.MainButton.disable();
            
            tape.innerHTML = '';
            tape.style.transition = 'none';
            tape.style.transform = 'translateX(0)';
            status.innerText = "–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã —Å–∫—Ä–∏–ø–∏—Ç...";

            const total = 30;
            const pool = [];

            for (let i = 0; i < total; i++) {
                const rand = Math.random() * 100;
                let res;
                if (rand > 95) res = reasons.filter(r => r.r === 'ancient')[Math.floor(Math.random()*2)];
                else if (rand > 80) res = reasons.filter(r => r.r === 'legendary')[Math.floor(Math.random()*2)];
                else if (rand > 50) res = reasons.filter(r => r.r === 'rare')[Math.floor(Math.random()*3)];
                else res = reasons.filter(r => r.r === 'common')[Math.floor(Math.random()*4)];
                
                pool.push(res || reasons[0]);
                const el = document.createElement('div');
                el.className = reason-card r-${pool[i].r};
                el.innerText = pool[i].t;
                tape.appendChild(el);
            }

            setTimeout(() => {
                const target = total - 4;
                const centerOffset = (document.querySelector('.viewport').offsetWidth / 2);
                const finalPos = (target * cardWidth) + (cardWidth / 2) - centerOffset;
                
                tape.style.transition = 'transform 4s cubic-bezier(0.1, 0, 0.1, 1)';
                tape.style.transform = translateX(-${finalPos}px);

                // –≠—Ñ—Ñ–µ–∫—Ç –≤–∏–±—Ä–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ü–µ
                setTimeout(() => {
                    const win = pool[target];
                    status.innerHTML = –¢–≤–æ–π –≤–µ—Ä–¥–∏–∫—Ç: <b class="r-${win.r}">${win.t}</b>;
                    tg.HapticFeedback.impactOccurred('heavy');
                    tg.MainButton.enable();
                    tg.MainButton.setText("–ï–©–ï –†–ê–ó?");
                }, 4100);
            }, 50);
        }
    </script>
</body>
</html>
